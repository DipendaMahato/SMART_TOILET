'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { Waves } from 'lucide-react';

interface UrineQualityResultProps {
  tdsValue: number | undefined;
  turbidityValue: number | undefined;
}

export function UrineQualityResult({ tdsValue, turbidityValue }: UrineQualityResultProps) {
  // TDS Logic
  const tds = tdsValue ?? 0;
  let tdsStatus: 'Normal' | 'Slightly Abnormal' | 'Abnormal';
  if (tds <= 300) {
    tdsStatus = 'Normal';
  } else if (tds > 300 && tds <= 500) {
    tdsStatus = 'Slightly Abnormal';
  } else {
    tdsStatus = 'Abnormal';
  }

  // Turbidity Logic
  const turbidity = turbidityValue ?? 0;
  let turbidityStatus: 'Normal' | 'Slightly Abnormal' | 'Abnormal';
  let turbidityText: string;
  if (turbidity < 20) {
    turbidityStatus = 'Normal';
    turbidityText = 'Clear';
  } else if (turbidity >= 20 && turbidity <= 50) {
    turbidityStatus = 'Slightly Abnormal';
    turbidityText = 'Slightly Cloudy';
  } else {
    turbidityStatus = 'Abnormal';
    turbidityText = 'Cloudy';
  }

  // Autogenerated Conclusion Logic
  const conclusionParts: string[] = [];
  if (tdsStatus === 'Slightly Abnormal') {
    conclusionParts.push('TDS level is slightly elevated, which could indicate mild dehydration.');
  } else if (tdsStatus === 'Abnormal') {
    conclusionParts.push('High TDS levels were detected. This may suggest dehydration or other health issues. Please ensure adequate fluid intake.');
  }

  if (turbidityStatus === 'Slightly Abnormal') {
    conclusionParts.push('The sample appears slightly cloudy, which is worth monitoring.');
  } else if (turbidityStatus === 'Abnormal') {
    conclusionParts.push('The sample is cloudy (high turbidity). This can sometimes be a sign of a urinary tract infection or kidney issues.');
  }

  let conclusion: string;
  let overallStatus: 'Normal' | 'Slightly Abnormal' | 'Abnormal';

  if (conclusionParts.length > 0) {
    conclusion = conclusionParts.join(' ');
    if (tdsStatus === 'Abnormal' || turbidityStatus === 'Abnormal') {
      overallStatus = 'Abnormal';
      conclusion += ' Given these findings, consulting a healthcare professional for further evaluation is highly recommended.';
    } else {
      overallStatus = 'Slightly Abnormal';
      conclusion += ' No immediate concern is indicated, but continued monitoring is advised. Maintain good hydration.';
    }
  } else {
    overallStatus = 'Normal';
    conclusion = 'The sample appears clean and all markers are within the normal range. Great job maintaining your health!';
  }

  const getStatusClasses = (status: 'Normal' | 'Slightly Abnormal' | 'Abnormal') => {
    switch (status) {
      case 'Normal':
        return 'bg-status-green/20 text-status-green border-status-green/30';
      case 'Slightly Abnormal':
        return 'bg-status-yellow/20 text-status-yellow border-status-yellow/30';
      case 'Abnormal':
        return 'bg-status-red/20 text-status-red border-status-red/30';
    }
  };
  
  const getBorderClass = (status: 'Normal' | 'Slightly Abnormal' | 'Abnormal') => {
    switch (status) {
        case 'Normal': return 'border-status-green/50';
        case 'Slightly Abnormal': return 'border-status-yellow/50 shadow-lg shadow-status-yellow/10';
        case 'Abnormal': return 'border-status-red/50 shadow-lg shadow-status-red/10 animate-pulse';
    }
  }

  return (
    <Card className={cn("bg-card/50 border-2 w-full transition-all duration-300", getBorderClass(overallStatus))}>
        <CardHeader className="items-center pb-4">
            <div className="flex items-center gap-3">
                <Waves className="h-6 w-6 text-primary" />
                <CardTitle className="font-headline text-lg tracking-wider">
                    URINE QUALITY RESULT
                </CardTitle>
            </div>
        </CardHeader>
        <CardContent className="p-6 pt-0">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-center text-center">
                <div className="space-y-2">
                    <h4 className="font-semibold text-primary/90 text-lg">TDS</h4>
                    <p className="text-4xl font-bold text-gray-200">
                        {tds}
                        <span className="text-2xl text-muted-foreground ml-1">ppm</span>
                    </p>
                    <Badge className={cn('font-bold text-sm', getStatusClasses(tdsStatus))} variant="outline">
                        {tdsStatus}
                    </Badge>
                </div>
                <div className="space-y-2">
                    <h4 className="font-semibold text-primary/90 text-lg">Turbidity</h4>
                     <p className="text-4xl font-bold text-gray-200">
                        {turbidityValue !== undefined ? turbidityValue.toFixed(1) : '...'}
                        <span className="text-2xl text-muted-foreground ml-1">NTU</span>
                    </p>
                    <Badge className={cn('font-bold text-sm', getStatusClasses(turbidityStatus))} variant="outline">
                        {turbidityText}
                    </Badge>
                </div>
            </div>
            <div className="mt-6 pt-4 border-t border-border/50">
                <h3 className="text-lg font-bold text-primary/90">Conclusion:</h3>
                <p className="text-base text-muted-foreground mt-2">
                    {conclusion}
                </p>
            </div>
        </CardContent>
    </Card>
  );
}
